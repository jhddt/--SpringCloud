# 前端选课功能更新总结

## 更新日期
2025-11-10

## 更新概述
本次更新主要针对前端选课相关页面，使其适配新的选课流程（无需审核，直接成功）。主要修改包括：
1. 学生端课程浏览页面 - 使用新的可选课程接口
2. 学生端我的选课页面 - 更新状态显示和退课接口
3. 学生端成绩查询页面 - 更新状态过滤
4. 管理员端选课管理页面 - 移除审核功能，更新状态显示
5. 教师端选课管理页面 - 移除审核功能，更新状态显示
6. 教师端成绩管理页面 - 更新状态过滤
7. 管理员端Dashboard - 更新状态显示

## 详细修改内容

### 1. 学生端课程浏览页面 (CourseBrowse.vue)

#### 修改内容
- **使用新的可选课程接口**：从 `/course/page` 改为 `/selection/available`
- **自动过滤**：后端自动过滤已选、已满、时间冲突、专业不匹配等课程
- **移除前端判断**：移除 `isSelected` 和 `isFull` 判断，因为后端已过滤
- **更新选课成功提示**：从"选课成功，等待审核"改为"选课成功"
- **添加剩余容量显示**：在表格中添加剩余容量列

#### 关键代码变更
```vue
// 使用新的可选课程接口
const response = await api.get('/selection/available', {
  params: {
    studentId: userStore.studentId,
    current: currentPage.value,
    size: pageSize.value,
    keyword: keyword.value
  }
})
```

### 2. 学生端我的选课页面 (MySelection.vue)

#### 修改内容
- **更新状态显示**：
  - status=0: "已选" (success)
  - status=1: "已退" (info)
- **更新退课接口**：从 `DELETE /selection/${id}` 改为 `PUT /selection/${id}/cancel`
- **简化操作按钮**：只显示"退课"按钮（status=0时），已退课显示"已退课"文本

#### 关键代码变更
```vue
// 更新状态映射
const getStatusText = (status) => {
  const statusMap = {
    0: '已选',  // 0-已选（正常状态）
    1: '已退'   // 1-已退
  }
  return statusMap[status] || '未知'
}

// 使用正确的退课接口
const response = await api.put(`/selection/${row.id}/cancel`, null, {
  params: { studentId: userStore.studentId }
})
```

### 3. 学生端成绩查询页面 (GradeQuery.vue)

#### 修改内容
- **更新状态过滤**：移除 `status: 1` 参数，改为前端过滤 `status === 0` 的记录
- **更新统计逻辑**：只统计已选课程（status=0）

#### 关键代码变更
```vue
// 移除 status 参数，前端过滤
const allRecords = response.data.data.records || []
tableData.value = allRecords.filter(r => r.status === 0)
```

### 4. 管理员端选课管理页面 (SelectionManagement.vue)

#### 修改内容
- **移除审核功能**：删除"通过"和"拒绝"按钮
- **更新状态显示**：
  - status=0: "已选" (success)
  - status=1: "已退" (info)
- **简化操作列**：只显示状态文本，无操作按钮

#### 关键代码变更
```vue
// 移除审核相关代码
// 更新状态映射
const getStatusText = (status) => {
  const statusMap = {
    0: '已选',  // 0-已选（正常状态）
    1: '已退'   // 1-已退
  }
  return statusMap[status] || '未知'
}
```

### 5. 教师端选课管理页面 (SelectionManagement.vue)

#### 修改内容
- **移除审核功能**：删除"通过"和"拒绝"按钮
- **更新状态显示**：与管理员端一致
- **简化操作列**：只显示状态文本

### 6. 教师端成绩管理页面 (GradeManagement.vue)

#### 修改内容
- **更新状态过滤**：移除 `status: 1` 参数，改为前端过滤 `status === 0` 的记录
- **成绩保存功能**：添加了成绩输入和保存功能（待后端实现）
- **显示学生信息**：正确显示学生姓名、学号、课程名称、学分等信息

#### 关键代码变更
```vue
// 只显示已选课程（status=0）
const allRecords = response.data.data.records || []
const selectedRecords = allRecords.filter(r => r.status === 0)
tableData.value = selectedRecords.map(r => ({
  ...r,
  editing: false
}))
```

### 7. 管理员端Dashboard (Dashboard.vue)

#### 修改内容
- **更新状态显示**：在最近选课表格中更新状态显示
  - status=0: "已选" (success)
  - status=1: "已退" (info)

## 状态映射说明

### 新的状态映射
- **status=0**: 已选（正常状态）
- **status=1**: 已退

### 旧的状态映射（已废弃）
- **status=0**: 待审核
- **status=1**: 已通过
- **status=2**: 已拒绝

## API接口变更

### 新增接口
- `GET /selection/available` - 获取可选课程列表（自动过滤）

### 接口变更
- `PUT /selection/{id}/cancel` - 取消选课（退课）

### 接口移除
- `PUT /selection/{id}/approve` - 审核选课（已移除，因为不需要审核）

## 待实现功能

### 成绩保存功能
- **当前状态**：前端已实现成绩输入和保存按钮，但后端接口待实现
- **需要的工作**：
  1. 在 `enrollments` 表中添加 `score` 字段（DECIMAL类型）
  2. 在 `Enrollment` 实体中添加 `score` 字段
  3. 在 `SelectionService` 中添加 `updateScore` 方法
  4. 在 `SelectionController` 中添加 `PUT /selection/{id}/score` 接口

## 测试建议

### 1. 学生端测试
- [ ] 测试课程浏览页面，验证可选课程列表正确显示
- [ ] 测试选课功能，验证选课成功后课程从列表中消失
- [ ] 测试我的选课页面，验证已选课程正确显示
- [ ] 测试退课功能，验证退课成功后状态更新
- [ ] 测试成绩查询页面，验证成绩正确显示

### 2. 管理员端测试
- [ ] 测试选课管理页面，验证选课记录正确显示
- [ ] 测试状态显示，验证"已选"和"已退"状态正确显示
- [ ] 测试Dashboard，验证最近选课状态正确显示

### 3. 教师端测试
- [ ] 测试选课管理页面，验证选课记录正确显示
- [ ] 测试成绩管理页面，验证学生列表正确显示
- [ ] 测试成绩输入功能（待后端接口实现后）

## 注意事项

1. **状态一致性**：确保所有前端页面使用相同的状态映射（status=0表示已选，status=1表示已退）
2. **接口兼容性**：确保后端接口返回的数据格式与前端期望的一致
3. **错误处理**：确保所有API调用都有适当的错误处理
4. **数据验证**：确保前端对用户输入进行适当验证

## 后续工作

1. **实现成绩保存功能**：添加后端接口支持成绩保存
2. **优化性能**：考虑对可选课程列表进行缓存
3. **添加筛选功能**：在选课管理页面添加筛选功能（按状态、课程等）
4. **添加导出功能**：添加选课记录导出功能

## 文件清单

### 修改的文件
1. `frontend-student/src/views/CourseBrowse.vue`
2. `frontend-student/src/views/MySelection.vue`
3. `frontend-student/src/views/GradeQuery.vue`
4. `frontend-admin/src/views/SelectionManagement.vue`
5. `frontend-admin/src/views/Dashboard.vue`
6. `frontend-teacher/src/views/SelectionManagement.vue`
7. `frontend-teacher/src/views/GradeManagement.vue`

### 新增的文件
无

### 删除的文件
无

## 总结

本次更新成功将前端选课功能适配到新的选课流程，移除了审核功能，更新了状态显示，并优化了用户体验。所有修改已完成，代码已通过语法检查，可以开始测试。

